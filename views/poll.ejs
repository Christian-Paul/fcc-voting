<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Voting App</title>
		<link rel='stylesheet' type='text/css' href='../public/poll.css'>
		<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
	</head>

	<body>

		<div class="background">
			<div class="navbar-container">
				<div class="navbar">
					<div class='destination'><a href='../'>All Polls</a></div>
					<div class='destination'><a href='../newpoll'>New Poll</a></div>
				</div>
			</div>

			<div class='main-container'>
				<div class="poll-holder">
					<div class='poll-interface'>
						<div class="poll-title">
							<%= poll.title %>
						</div>
						<div class="poll-author">
							by <%= poll.author %>
						</div>
						<form method='POST'>
							<% for(prop in poll.options) { %>
								<div>
									<input type="radio" name='user-choice' value=<%= prop %>> <%= prop %>
								</div>
							<% } %>
							<button type='submit'>Submit</button>
						</form>
					</div>
					<div class="poll-results">
						<div class="poll-chart">
							<canvas id='myChart' width='400' height='400'></canvas>
						</div>
						<div class='text-results'>
							<% for(prop in poll.options) { %>
								<%= prop %>: <%= poll.options[prop] %>
							<% } %>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src='../public/Chart.min.js'></script>
		<script>
			var poll = <%- JSON.stringify(poll) %>;
			function getRandomColor() {
			    var letters = '0123456789ABCDEF'.split('');
			    var color = '#';
			    for (var i = 0; i < 6; i++ ) {
			        color += letters[Math.floor(Math.random() * 16)];
			    }
			    return color;
			}

			var categoryNames = [];
			var categoryVotes = [];
			var categoryColors = [];

			for(prop in poll.options) {
				categoryNames.push(prop);
				categoryVotes.push(poll.options[prop]);
				categoryColors.push(getRandomColor());
			};

			var ctx = document.getElementById('myChart');
			var myDoughnutChart = new Chart(ctx, {
			    type: 'doughnut',
			    data: {
			    	labels: categoryNames,
			    	datasets: [{
			    		data: categoryVotes,
			    		backgroundColor: categoryColors
			    	}]
			    }
			});
		</script>

	</body>
</html>